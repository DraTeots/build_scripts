ifndef ROOT_OF_ALL
  export ROOT_OF_ALL=$(shell pwd)
endif

ifndef BUILD_SCRIPTS
  export BUILD_SCRIPTS=$(shell pwd)/build_scripts
endif

MACHINE_NAME = $(shell uname -m)

CERNLIB = ${ROOT_OF_ALL}/cernlib
CLHEP_TOP = ${ROOT_OF_ALL}/clhep
SIM-RECON = ${ROOT_OF_ALL}/sim-recon
HDDS = ${ROOT_OF_ALL}/hdds
JANA = ${ROOT_OF_ALL}/jana
ROOT = ${ROOT_OF_ALL}/root
XERCES = ${ROOT_OF_ALL}/xerces-c
GEANT4 = ${ROOT_OF_ALL}/geant4
GSL = ${ROOT_OF_ALL}/gsl
CCDB = ${ROOT_OF_ALL}/ccdb

all: env xerces_build cernlib_build root_build clhep_build geant4_build gsl_build ccdb_build jana_build hdds_build sim-recon_build

cernlib_build: cernlib_dir cernlib_make

cernlib_dir:
	test -d ${CERNLIB} || mkdir -pv ${CERNLIB}

cernlib_make:
ifneq ($(MACHINE_NAME),x86_64)
	$(MAKE) -C${CERNLIB} -f${BUILD_SCRIPTS}/Makefile_cernlib
else
	$(MAKE) -C${CERNLIB} -f${BUILD_SCRIPTS}/Makefile_cernlib_Vogt
	test -d ${CERNLIB}/2005 || cp -pr ${CERNLIB}/cern/2005 $(CERNLIB)
endif

xerces_build: xerces_dir xerces_make

xerces_dir:
	test -d ${XERCES} || mkdir -pv ${XERCES}

xerces_make:
	$(MAKE) -C${XERCES} -f${BUILD_SCRIPTS}/Makefile_xercesc_3

root_build: root_dir
	    $(MAKE) -C${ROOT} -f${BUILD_SCRIPTS}/Makefile_root

root_dir:
	test -d ${ROOT} || mkdir -pv ${ROOT}

jana_build: jana_dir jana_make

jana_dir:
	test -d ${JANA} || mkdir -pv ${JANA}

jana_make:
	$(MAKE) -C${JANA} -f${BUILD_SCRIPTS}/Makefile_jana

hdds_build: hdds_dir hdds_make

hdds_dir:
	test -d ${HDDS} || mkdir -pv ${HDDS}

hdds_make:
	$(MAKE) -C${HDDS} -f${BUILD_SCRIPTS}/Makefile_hdds

sim-recon_build: sim-recon_dir sim-recon_make

sim-recon_dir:
	test -d ${SIM-RECON} || mkdir -pv ${SIM-RECON}

sim-recon_make:
	$(MAKE) -C${SIM-RECON} -f${BUILD_SCRIPTS}/Makefile_sim-recon

clhep_build: clhep_dir clhep_make

clhep_dir:
	test -d ${CLHEP_TOP} || mkdir -pv ${CLHEP_TOP}

clhep_make:
	$(MAKE) -C${CLHEP_TOP} -f${BUILD_SCRIPTS}/Makefile_clhep

calib_make:
	test -d calib || svn checkout https://halldsvn.jlab.org/repos/trunk/calib

geant4_build: geant4_dir geant4_make

geant4_dir:
	test -d ${GEANT4} || mkdir -pv ${GEANT4}

geant4_make:
	$(MAKE) -C$(GEANT4) -f$(BUILD_SCRIPTS)/Makefile_geant4

gsl_build: gsl_dir gsl_make

gsl_dir:
	test -d ${GSL} || mkdir -pv ${GSL}

gsl_make:
	$(MAKE) -C$(GSL) -f$(BUILD_SCRIPTS)/Makefile_gsl

ccdb_build: ccdb_dir ccdb_make

ccdb_dir:
	test -d ${CCDB} || mkdir -pv ${CCDB}

ccdb_make:
	$(MAKE) -C$(CCDB) -f$(BUILD_SCRIPTS)/Makefile_ccdb

env:
	@echo BUILD_SCRIPTS = ${BUILD_SCRIPTS}
	@echo HALLD = ${HALLD}
	@echo ROOT_OF_ALL = ${ROOT_OF_ALL}
