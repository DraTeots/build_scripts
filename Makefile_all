ifndef ROOT_OF_ALL
  export ROOT_OF_ALL=$(shell pwd)
endif

ifndef BUILD_SCRIPTS
  export BUILD_SCRIPTS=$(shell pwd)/build_scripts
endif

ROOT = ${ROOT_OF_ALL}/root
JANA = ${ROOT_OF_ALL}/jana
HALLD = ${ROOT_OF_ALL}/halld

all: env root_build jana_build halld_build

root_build: root_dir
	    $(MAKE) -C${ROOT} -f${BUILD_SCRIPTS}/Makefile_root

root_dir:
	test -d ${ROOT} || mkdir -pv ${ROOT}

jana_build: jana_dir jana_build_execute jana_prod_link

jana_dir:
	test -d ${JANA} || mkdir -pv ${JANA}

jana_build_execute:
	cd ${JANA}; ${BUILD_SCRIPTS}/jana_build.csh

jana_prod_link:
	cd ${JANA}; $(RM) prod; ln -s * prod

halld_build: halld_dir halld_build_execute

halld_dir:
	test -d ${HALLD} || mkdir -pv ${HALLD}

halld_build_execute:
	cd ${HALLD}; ${BUILD_SCRIPTS}/halld_build.csh

env:
	@echo BUILD_SCRIPTS = ${BUILD_SCRIPTS}
	@echo HALLD = ${HALLD}
	@echo ROOT_OF_ALL = ${ROOT_OF_ALL}
