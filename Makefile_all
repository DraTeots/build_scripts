ifndef ROOT_OF_ALL
  export ROOT_OF_ALL=$(shell pwd)
endif

ifndef BUILD_SCRIPTS
  export BUILD_SCRIPTS=$(shell pwd)/build_scripts
endif

CERNLIB = ${ROOT_OF_ALL}/cernlib
CLHEP = ${ROOT_OF_ALL}/clhep
HALLD = ${ROOT_OF_ALL}/halld
HDDS = ${ROOT_OF_ALL}/hdds
JANA = ${ROOT_OF_ALL}/jana
ROOT = ${ROOT_OF_ALL}/root
XERCES = ${ROOT_OF_ALL}/xerces-c

all: env xerces_build cernlib_build root_build clhep_build jana_build hdds_build halld_build calib_make

cernlib_build: cernlib_dir cernlib_make

cernlib_dir:
	test -d ${CERNLIB} || mkdir -pv ${CERNLIB}

cernlib_make:
	$(MAKE) -C${CERNLIB} -f${BUILD_SCRIPTS}/Makefile_cernlib

xerces_build: xerces_dir xerces_make

xerces_dir:
	test -d ${XERCES} || mkdir -pv ${XERCES}

xerces_make:
	$(MAKE) -C${XERCES} -f${BUILD_SCRIPTS}/Makefile_xerces

root_build: root_dir
	    $(MAKE) -C${ROOT} -f${BUILD_SCRIPTS}/Makefile_root

root_dir:
	test -d ${ROOT} || mkdir -pv ${ROOT}

jana_build: jana_dir jana_make

jana_dir:
	test -d ${JANA} || mkdir -pv ${JANA}

jana_make:
	$(MAKE) -C${JANA} -f${BUILD_SCRIPTS}/Makefile_jana

hdds_build: hdds_dir hdds_make

hdds_dir:
	test -d ${HDDS} || mkdir -pv ${HDDS}

hdds_make:
	$(MAKE) -C${HDDS} -f${BUILD_SCRIPTS}/Makefile_hdds

halld_build: halld_dir halld_make

halld_dir:
	test -d ${HALLD} || mkdir -pv ${HALLD}

halld_make:
	$(MAKE) -C${HALLD} -f${BUILD_SCRIPTS}/Makefile_halld

clhep_build: clhep_dir clhep_make

clhep_dir:
	test -d ${CLHEP} || mkdir -pv ${CLHEP}

clhep_make:
	$(MAKE) -C${CLHEP} -f${BUILD_SCRIPTS}/Makefile_clhep

calib_make:
	test -d calib || svn checkout https://halldsvn.jlab.org/repos/trunk/calib

env:
	@echo BUILD_SCRIPTS = ${BUILD_SCRIPTS}
	@echo HALLD = ${HALLD}
	@echo ROOT_OF_ALL = ${ROOT_OF_ALL}
