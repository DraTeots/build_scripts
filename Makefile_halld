PWD = $(shell pwd)
VERSION_LABEL = current
HALLD_SRC = src
REPOSITORY_LOCATION = trunk/$(HALLD_SRC)
export HALLD_HOME = $(PWD)/halld_$(VERSION_LABEL)
export HALLD_MY = $(HALLD_HOME)

all: make_halld

make_halld: $(HALLD_HOME)/.getarg_patches_done
	$(MAKE) -C$(HALLD_HOME)/src

$(HALLD_HOME)/.getarg_patches_done: create_src_link
	cd $(HALLD_HOME); cp -pv $(BUILD_SCRIPTS)/patches/getarg_fix/* $(HALLD_HOME)/src/programs/Simulation/HDGeant
	date > $@

create_src_link: $(HALLD_HOME)/.checkout_done
	if [ $(HALLD_SRC) != src ] ; then cd $(HALLD_HOME) ; test -L src || ln -s $(HALLD_SRC) src ; fi

$(HALLD_HOME)/.checkout_done: make_halld_dir
	cd $(HALLD_HOME); svn -q co https://halldsvn.jlab.org/repos/$(REPOSITORY_LOCATION)
	date > $@

make_halld_dir:
	test -d $(HALLD_HOME) || mkdir -p $(HALLD_HOME)
