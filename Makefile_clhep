ifndef CLHEP_VERSION
  CLHEP_VERSION=2.0.4.5
endif
TARFILE=clhep-$(CLHEP_VERSION).tgz
PWD = $(shell pwd)
CLHEPDIR=$(PWD)/$(CLHEP_VERSION)

all: prod_link

$(TARFILE):
	wget http://proj-clhep.web.cern.ch/proj-clhep/DISTRIBUTION/distributions/$(TARFILE)

$(CLHEPDIR)/.untar_done: $(TARFILE)
	tar zxvf $(TARFILE)
	date > $@

$(CLHEPDIR)/.configure_done: $(CLHEPDIR)/.untar_done
	cd $(CLHEPDIR)/CLHEP ; ./configure --prefix=$(CLHEPDIR)
	date > $@

do_make: $(CLHEPDIR)/.configure_done
	$(MAKE) -C$(CLHEPDIR)/CLHEP

do_make_install: do_make
	$(MAKE) -C$(CLHEPDIR)/CLHEP install

prod_link: do_make_install
	test -L prod || ln -s $(CLHEP_VERSION) prod # will not overwrite existing link
