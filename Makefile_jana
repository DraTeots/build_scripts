PWD = $(shell pwd)
JANA_VERSION = 0.4.9
JANA_DIR = jana_$(JANA_VERSION)
export JANA_HOME = $(PWD)/$(JANA_DIR)
TARFILE = jana_$(JANA_VERSION).tgz

all: prod_link

prod_link: make_install_jana
	test -L prod || ln -s $(JANA_DIR) prod # will not overwrite existing link

make_install_jana: make_jana
	$(MAKE) -C$(JANA_HOME)/src install

make_jana: $(JANA_HOME)/.configure_done
	$(MAKE) -C$(JANA_HOME)/src

# uncomment one of the following two lines to choose checkout of
# source code or retrieval of a tar file

#$(JANA_HOME)/.configure_done: $(JANA_HOME)/.checkout_done # checkout
$(JANA_HOME)/.configure_done: $(JANA_HOME)/.untar_done # tar file
	cd $(JANA_HOME)/src; ./configure --with-xerces=$(XERCESCROOT)
	date > $@

$(JANA_HOME)/.checkout_done:
	svn co https://phys12svn.jlab.org/repos/tags/JANA_marki_freeze
	date > $@

$(JANA_HOME)/.untar_done: $(TARFILE)
	tar zxvf $(TARFILE)
	date > $@

$(TARFILE):
	wget http://www.jlab.org/JANA/releases/$(TARFILE)
