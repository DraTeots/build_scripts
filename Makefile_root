ifndef ROOT_VERSION
    ROOT_VERSION=5.34.04
endif

TARFILE=root_v$(ROOT_VERSION).source.tar.gz
ROOTDIR=root_$(ROOT_VERSION)
PWD := $(shell pwd)
ROOTSYS=$(PWD)/$(ROOTDIR)

all: prod_link

prod_link: main_make
	   test -L prod || ln -s $(ROOTDIR) prod # will not overwrite existing link 

$(TARFILE):
	wget ftp://root.cern.ch/root/$@

$(ROOTDIR)/.untar_done: $(TARFILE)
	$(RM) -r $(ROOTDIR)
	tar zxf $(TARFILE)
	mv root $(ROOTDIR)
	date > $@

$(ROOTDIR)/.configure_done: $(ROOTDIR)/.untar_done
	cd $(ROOTDIR); ./configure
	date > $@

main_make: $(ROOTDIR)/.configure_done $(ROOTDIR)/.patch_done
	cd $(ROOTDIR) ; make

$(ROOTDIR)/.patch_done:
	#needed for 5.19.04
	#cd $(ROOTDIR); patch -p1 < $(BUILD_SCRIPTS)/patches/root/patch_stropts.txt
	touch $@
